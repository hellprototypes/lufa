#ifdef HELL_WATCH_PORT
#include <avr/pgmspace.h>
#include <util/delay.h>

#define OLED_ACTIVE() 		(PORTD.OUTCLR = 1 << 0)//clrbit(PORT_OLED_OUT, PIN_OLED_CS)
#define OLED_DEACTIVE()   (PORTD.OUTSET = 1 << 0)//setbit(PORT_OLED_OUT, PIN_OLED_CS)
#define CMD_MODE()			(PORTD.OUTCLR = 1 << 2)//clrbit(PORT_OLED_OUT,PIN_OLED_DC)
#define DATA_MODE()		(PORTD.OUTSET = 1 << 2)//setbit(PORT_OLED_OUT,PIN_OLED_DC)

#define KEY_NONE				0
#define KEY_BTM_LEFT			1
#define KEY_BTM_RIGHT			2
#define KEY_3WS_DOWN			3
#define KEY_3WS_PUSH			4
#define KEY_3WS_UP				5
#define KEY_TOP_RIGHT			6
#define KEY_TOP_LEFT			7
#define KEY_MAIN				8
#define KEY_WAIT_FLAG			0xFF

const uint8_t hell_watch_logo_avrisp[] PROGMEM ={
	0x00,0x00,0x00,0xFC,0xFC,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFC,0xFC,0xFC,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x80,0x00,0x00,
	0x00,0x00,0xFE,0xFE,0xFE,0x00,0x00,0x00,0x00,0xFE,0xFE,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x7C,0xFC,0xF8,0x80,0x00,0x00,0x00,0xC0,0xF8,0xFC,
	0xFC,0xFC,0xF0,0x00,0x00,0x00,0x00,0xE0,0xFC,0xFC,0x3C,0x00,0x00,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x80,0x00,0x00,0x00,0xC0,0xE0,0xF8,0xF8,0xC0,0xC0,
	0xC0,0xC0,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x00,0xFE,0xFE,0xFE,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x80,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0xFF,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFE,0xFF,0xFF,0x19,0x18,0x18,0x18,0x19,0x1F,0x1F,0x1E,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x3F,0xFF,0xFC,0xF0,0xFC,0xFF,0x1F,0x01,
	0x00,0x07,0x3F,0xFF,0xF8,0xE0,0xFE,0xFF,0x1F,0x01,0x00,0x00,0xC0,0xF0,0xF1,0x78,0x18,0x18,0x18,0x18,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x10,0xFF,0xFF,0xFF,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x03,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x47,0x47,0x47,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x47,0x47,0x47,0x40,0x40,0x40,0x40,0x40,0x43,0x43,0x47,0x46,0x46,0x46,0x46,0x46,0x47,0x40,0x40,
	0x40,0x40,0x47,0x47,0x47,0x40,0x40,0x40,0x40,0x47,0x47,0x47,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x43,0x47,0x47,0x47,0x41,0x40,0x40,
	0x40,0x40,0x40,0x43,0x47,0x47,0x47,0x41,0x40,0x40,0x40,0x40,0x40,0x43,0x47,0x47,0x46,0x46,0x46,0x47,0x43,0x47,0x47,0x40,0x40,0x40,0x40,0x40,0x43,0x47,0x47,0x46,
	0x46,0x46,0x40,0x40,0x41,0x43,0x43,0x47,0x46,0x46,0x46,0x46,0x46,0x40,0x40,0x40,0x47,0x47,0x47,0x40,0x40,0x40,0x40,0x40,0x47,0x47,0x47,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xE0,0x70,0xF0,0xC0,0x00,0xF0,0xF0,0x00,0x00,0x80,0xC0,0x60,0x30,0x90,0xF0,0x70,0x10,0x90,0xF0,0x70,
	0x00,0x00,0xF0,0xF0,0x10,0x10,0xC0,0xE0,0xB0,0x10,0x10,0x10,0x10,0x10,0x80,0xF0,0x70,0x10,0x10,0xF0,0xF0,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x00,0x00,0xC0,0xF0,0x30,0x00,0x80,0x80,0x80,0x00,0xF0,0xF0,0x10,0x10,0x00,0xF0,0xF0,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x18,0x0E,0x07,0x03,0x02,0x02,0x1F,0x1F,0x00,0x1F,0x1F,0x1C,0x06,0x03,0x01,0x00,0x1C,0x1F,0x03,0x03,0x1F,0x1F,0x00,0x10,
	0x18,0x1F,0x17,0x00,0x10,0x10,0x10,0x11,0x11,0x1B,0x0F,0x06,0x00,0x1C,0x1F,0x03,0x02,0x02,0x03,0x01,0x00,0x00,0x00,0x00,0x10,0x1E,0x0F,0x01,0x00,0x1C,0x1F,0x03,
	0x00,0x1C,0x1F,0x03,0x10,0x1E,0x0F,0x07,0x0F,0x19,0x11,0x10,0x18,0x1F,0x17,0x00,0x10,0x18,0x1F,0x17,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xF0,0x38,0x18,0x0C,0x04,0x04,0x04,0x04,0xE0,0x7C,0x0C,0x80,0xC0,0x60,0x20,0x20,0xE0,0xE0,0x00,0x80,0xE0,0x60,
	0x20,0x20,0xE0,0xE0,0x00,0x80,0xC0,0xE0,0xA0,0xA0,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0xC0,0xE0,0x38,0x1C,0x04,0x00,0xE0,0xFC,0x5C,0x44,0x44,0x44,0x84,0xE0,0x60,
	0x20,0x20,0x80,0xC0,0x60,0x20,0x20,0xE0,0xE0,0x00,0x80,0xE0,0x60,0x20,0x20,0xE0,0xE0,0x20,0x20,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xFC,0x1C,0x00,0x00,
	0x00,0x00,0xE0,0xFC,0x1C,0x00,0x00,0xE0,0xFC,0x1C,0x00,0xE0,0xFC,0x5C,0x44,0x44,0x44,0x84,0xC0,0xE0,0xB8,0x9C,0xFC,0xF0,0x00,0x00,0x00,0xC4,0xFC,0x18,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x07,0x06,0x04,0x04,0x04,0x00,0x00,0x07,0x03,0x00,0x00,0x07,0x07,0x04,0x04,0x06,0x03,0x01,0x04,0x07,0x03,0x00,
	0x00,0x07,0x07,0x00,0x00,0x07,0x07,0x04,0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x04,0x1F,0x13,0x00,0x00,0x00,0x07,0x07,0x00,0x00,0x00,0x00,0x04,0x07,0x01,0x00,
	0x00,0x00,0x07,0x07,0x04,0x04,0x06,0x03,0x01,0x04,0x07,0x03,0x00,0x00,0x07,0x07,0x00,0x00,0x07,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x07,0x04,0x04,0x04,0x04,
	0x00,0x03,0x07,0x04,0x04,0x06,0x03,0x03,0x00,0x00,0x07,0x07,0x00,0x00,0x00,0x04,0x06,0x03,0x01,0x00,0x00,0x00,0x07,0x07,0x10,0x18,0x0E,0x07,0x01,0x00,0x00,0x00,
};
const uint8_t hell_watch_logo_usb2serial[] PROGMEM ={
	0x00,0x00,0x00,0xFC,0xFC,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFC,0xFC,0xFC,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x80,0x00,0x00,
	0x00,0x00,0xFE,0xFE,0xFE,0x00,0x00,0x00,0x00,0xFE,0xFE,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x7C,0xFC,0xF8,0x80,0x00,0x00,0x00,0xC0,0xF8,0xFC,
	0xFC,0xFC,0xF0,0x00,0x00,0x00,0x00,0xE0,0xFC,0xFC,0x3C,0x00,0x00,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x80,0x00,0x00,0x00,0xC0,0xE0,0xF8,0xF8,0xC0,0xC0,
	0xC0,0xC0,0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x00,0xFE,0xFE,0xFE,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x80,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0xFF,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFE,0xFF,0xFF,0x19,0x18,0x18,0x18,0x19,0x1F,0x1F,0x1E,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x3F,0xFF,0xFC,0xF0,0xFC,0xFF,0x1F,0x01,
	0x00,0x07,0x3F,0xFF,0xF8,0xE0,0xFE,0xFF,0x1F,0x01,0x00,0x00,0xC0,0xF0,0xF1,0x78,0x18,0x18,0x18,0x18,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x10,0xFF,0xFF,0xFF,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x03,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xC7,0xC7,0xC7,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC7,0xC7,0xC7,0xC0,0xC0,0xC0,0xC0,0xC0,0xC3,0xC3,0xC7,0xC6,0xC6,0xC6,0xC6,0xC6,0xC7,0xC0,0xC0,
	0xC0,0xC0,0xC7,0xC7,0xC7,0xC0,0xC0,0xC0,0xC0,0xC7,0xC7,0xC7,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC3,0xC7,0xC7,0xC7,0xC1,0xC0,0xC0,
	0xC0,0xC0,0xC0,0xC3,0xC7,0xC7,0xC7,0xC1,0xC0,0xC0,0xC0,0xC0,0xC0,0xC3,0xC7,0xC7,0xC6,0xC6,0xC6,0xC7,0xC3,0xC7,0xC7,0xC0,0xC0,0xC0,0xC0,0xC0,0xC3,0xC7,0xC7,0xC6,
	0xC6,0xC6,0xC0,0xC0,0xC1,0xC3,0xC3,0xC7,0xC6,0xC6,0xC6,0xC6,0xC6,0xC0,0xC0,0xC0,0xC7,0xC7,0xC7,0xC0,0xC0,0xC0,0xC0,0xC0,0xC7,0xC7,0xC7,0xC0,0xC0,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xF0,0x30,0x00,0x00,0xE0,0xF0,0x30,0x00,0xC0,0xE0,0xB0,0x10,0x10,0x10,0x10,0x00,0xC0,0xF0,0x30,0x90,0xF0,0xF0,
	0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xC0,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xE0,0xB0,0x10,0x10,0x10,0x10,0x00,0x00,
	0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x00,0xA0,0xA0,0x20,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0xC0,0xF0,0x30,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0x1F,0x11,0x10,0x18,0x0F,0x07,0x01,0x10,0x10,0x10,0x11,0x1B,0x0F,0x06,0x00,0x10,0x1E,0x1F,0x11,0x19,0x0F,0x06,0x00,
	0x00,0x00,0x00,0x00,0x00,0x1E,0x1F,0x11,0x00,0x00,0x1E,0x1F,0x11,0x18,0x0F,0x07,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x11,0x1B,0x0F,0x06,0x00,0x00,0x1E,0x1F,
	0x13,0x12,0x13,0x03,0x00,0x10,0x1E,0x0F,0x01,0x00,0x10,0x1E,0x0F,0x01,0x00,0x1C,0x1E,0x12,0x1A,0x1F,0x0F,0x00,0x10,0x1E,0x0F,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xE0,0x38,0x1C,0x04,0x00,0xE0,0xFC,0x5C,0x44,0x44,0x44,0x84,0xE0,0x60,
	0x20,0x20,0x80,0xC0,0x60,0x20,0x20,0xE0,0xE0,0x00,0x80,0xE0,0x60,0x20,0x20,0xE0,0xE0,0x20,0x20,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xFC,0x1C,0x00,0x00,
	0x00,0x00,0xE0,0xFC,0x1C,0x00,0x00,0xE0,0xFC,0x1C,0x00,0xE0,0xFC,0x5C,0x44,0x44,0x44,0x84,0xC0,0xE0,0xB8,0x9C,0xFC,0xF0,0x00,0x00,0x00,0xC4,0xFC,0x18,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x1F,0x13,0x00,0x00,0x00,0x07,0x07,0x00,0x00,0x00,0x00,0x04,0x07,0x01,0x00,
	0x00,0x00,0x07,0x07,0x04,0x04,0x06,0x03,0x01,0x04,0x07,0x03,0x00,0x00,0x07,0x07,0x00,0x00,0x07,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x07,0x04,0x04,0x04,0x04,
	0x00,0x03,0x07,0x04,0x04,0x06,0x03,0x03,0x00,0x00,0x07,0x07,0x00,0x00,0x00,0x04,0x06,0x03,0x01,0x00,0x00,0x00,0x07,0x07,0x10,0x18,0x0E,0x07,0x01,0x00,0x00,0x00,
};
const uint8_t Font_5x8[] PROGMEM ={
	0x00,0x00,0x00,0x00,0x00,0x00,0x5F,0x00,0x00,0x00,0x00,0x07,0x00,0x07,0x00,0x14,0x7F,0x14,0x7F,0x14,0x24,0x2A,0x7F,0x2A,0x12,0x23,0x13,0x08,0x64,0x62,0x36,0x49,0x55,0x22,0x50,0x00,0x05,0x03,0x00,0x00,
	0x1C,0x22,0x41,0x00,0x00,0x41,0x22,0x1C,0x00,0x00,0x08,0x2A,0x1C,0x2A,0x08,0x08,0x08,0x3E,0x08,0x08,0xA0,0x60,0x00,0x00,0x00,0x08,0x08,0x08,0x08,0x08,0x60,0x60,0x00,0x00,0x00,0x20,0x10,0x08,0x04,0x02,
	0x3E,0x51,0x49,0x45,0x3E,0x00,0x42,0x7F,0x40,0x00,0x62,0x51,0x49,0x49,0x46,0x22,0x41,0x49,0x49,0x36,0x18,0x14,0x12,0x7F,0x10,0x27,0x45,0x45,0x45,0x39,0x3C,0x4A,0x49,0x49,0x30,0x01,0x71,0x09,0x05,0x03,
	0x36,0x49,0x49,0x49,0x36,0x06,0x49,0x49,0x29,0x1E,0x00,0x36,0x36,0x00,0x00,0x00,0xAC,0x6C,0x00,0x00,0x08,0x14,0x22,0x41,0x00,0x14,0x14,0x14,0x14,0x14,0x41,0x22,0x14,0x08,0x00,0x02,0x01,0x51,0x09,0x06,
	0x32,0x49,0x79,0x41,0x3E,0x7E,0x09,0x09,0x09,0x7E,0x7F,0x49,0x49,0x49,0x36,0x3E,0x41,0x41,0x41,0x22,0x7F,0x41,0x41,0x22,0x1C,0x7F,0x49,0x49,0x49,0x41,0x7F,0x09,0x09,0x09,0x01,0x3E,0x41,0x41,0x51,0x72,
	0x7F,0x08,0x08,0x08,0x7F,0x41,0x7F,0x41,0x00,0x00,0x20,0x40,0x41,0x3F,0x01,0x7F,0x08,0x14,0x22,0x41,0x7F,0x40,0x40,0x40,0x40,0x7F,0x02,0x0C,0x02,0x7F,0x7F,0x04,0x08,0x10,0x7F,0x3E,0x41,0x41,0x41,0x3E,
	0x7F,0x09,0x09,0x09,0x06,0x3E,0x41,0x51,0x21,0x5E,0x7F,0x09,0x19,0x29,0x46,0x26,0x49,0x49,0x49,0x32,0x01,0x01,0x7F,0x01,0x01,0x3F,0x40,0x40,0x40,0x3F,0x1F,0x20,0x40,0x20,0x1F,0x3F,0x40,0x38,0x40,0x3F,
	0x63,0x14,0x08,0x14,0x63,0x03,0x04,0x78,0x04,0x03,0x61,0x51,0x49,0x45,0x43,0x7F,0x41,0x41,0x00,0x00,0x02,0x04,0x08,0x10,0x20,0x41,0x41,0x7F,0x00,0x00,0x04,0x02,0x01,0x02,0x04,0x80,0x80,0x80,0x80,0x80,
	0x01,0x02,0x04,0x00,0x00,0x20,0x54,0x54,0x54,0x78,0x7F,0x48,0x44,0x44,0x38,0x38,0x44,0x44,0x28,0x00,0x38,0x44,0x44,0x48,0x7F,0x38,0x54,0x54,0x54,0x18,0x08,0x7E,0x09,0x02,0x00,0x18,0xA4,0xA4,0xA4,0x7C,
	0x7F,0x08,0x04,0x04,0x78,0x00,0x7D,0x00,0x00,0x00,0x80,0x84,0x7D,0x00,0x00,0x7F,0x10,0x28,0x44,0x00,0x41,0x7F,0x40,0x00,0x00,0x7C,0x04,0x18,0x04,0x78,0x7C,0x08,0x04,0x7C,0x00,0x38,0x44,0x44,0x38,0x00,
	0xFC,0x24,0x24,0x18,0x00,0x18,0x24,0x24,0xFC,0x00,0x00,0x7C,0x08,0x04,0x00,0x48,0x54,0x54,0x24,0x00,0x04,0x7F,0x44,0x00,0x00,0x3C,0x40,0x40,0x7C,0x00,0x1C,0x20,0x40,0x20,0x1C,0x3C,0x40,0x30,0x40,0x3C,
	0x44,0x28,0x10,0x28,0x44,0x1C,0xA0,0xA0,0x7C,0x00,0x44,0x64,0x54,0x4C,0x44,0x08,0x36,0x41,0x00,0x00,0x00,0x7F,0x00,0x00,0x00,0x41,0x36,0x08,0x00,0x00,0x02,0x01,0x01,0x02,0x01,0x02,0x05,0x05,0x02,0x00
};
void hell_watch_oled_cmd (uint8_t cmd)
{
    USARTD0.DATA= cmd;
    while(!(USARTD0.STATUS & (1 << 6)));
    USARTD0.STATUS |= 1 << 6;
}
void hell_watch_disp_logo(uint8_t index)
{
    uint16_t i;
	const uint8_t *p;
	if(index == 0) {
		p = hell_watch_logo_avrisp;
	} else if(index == 1) {
		p = hell_watch_logo_usb2serial;
	} else {
		return;
	}
    OLED_ACTIVE();
	CMD_MODE();
    hell_watch_oled_cmd(0xB0);//OLED_SET_PAGE
    hell_watch_oled_cmd(0x10);//OLED_SET_COL_HI :  Set column at 0
    hell_watch_oled_cmd(0x00);//OLED_SET_COL_LO

    DATA_MODE();
   	// Send data to display
    for(i=0; i<sizeof(hell_watch_logo_avrisp); i++) {
        while(!(USARTD0.STATUS &  (1<<5)));
		USARTD0.DATA= pgm_read_byte(&p[i]);
    }
    while(!(USARTD0.STATUS &  (1<<6)));
    USARTD0.STATUS |= 1 <<6;

    OLED_DEACTIVE();
}

void hell_watch_print_c(char c)
{
	uint16_t offset = (uint16_t)(c - ' ') * 5;

	USARTD0.DATA = 0x00;
	for(uint8_t i=0; i<5; i++) {
		while(!(USARTD0.STATUS &  (1<<5)));
		USARTD0.DATA= pgm_read_byte(&Font_5x8[offset++]);
	}
	while(!(USARTD0.STATUS &  (1<<6)));
	USARTD0.STATUS |= 1 <<6;
}

void hell_watch_print(char *msg)
{
	char c;

    OLED_ACTIVE();

	CMD_MODE();
    hell_watch_oled_cmd(0xB7);//OLED_SET_PAGE
	hell_watch_oled_cmd(0x10);//OLED_SET_COL_HI :  Set column at 0
    hell_watch_oled_cmd(0x00);//OLED_SET_COL_LO
	DATA_MODE();
	for(uint8_t i=0; i<128; i++) {
		while(!(USARTD0.STATUS &  (1<<5)));
		USARTD0.DATA= 0x00;
	}
	while(!(USARTD0.STATUS &  (1<<6)));
	USARTD0.STATUS |= 1 <<6;
	CMD_MODE();
	hell_watch_oled_cmd(0xB7);//OLED_SET_PAGE
	hell_watch_oled_cmd(0x10);//OLED_SET_COL_HI :  Set column at 0
    hell_watch_oled_cmd(0x00);//OLED_SET_COL_LO
	DATA_MODE();

	c=*msg++;
	while(c) {
		hell_watch_print_c(c);
		c=*msg++;
	}

	OLED_DEACTIVE();
}

void hell_watch_hw_init(void)
{
	PMIC.CTRL = PMIC_LOLVLEN_bm | PMIC_MEDLVLEN_bm | PMIC_HILVLEN_bm; //enable all interrupt level
	//Chang system clock to ext 16M clock and setup usb clock

	//Clock init
	DFLLRC32M.CTRL = 0;

	CCP = CCP_IOREG_gc;
	CLK.CTRL = CLK_SCLKSEL_RC2M_gc; // Run at 2M

	OSC.CTRL = OSC_RC2MEN_bm;

	OSC.XOSCCTRL = 0xCB;	// Crystal type 0.4-16 MHz XTAL - 16K CLK Start Up time
	OSC.CTRL = OSC_RC2MEN_bm | OSC_XOSCEN_bm;

	while (!(OSC.STATUS & OSC_XOSCRDY_bm));//wait xosc ready

	CCP = CCP_IOREG_gc;
	CLK.CTRL = CLK_SCLKSEL_XOSC_gc; // Use xosc as system clock

	OSC.PLLCTRL = OSC_PLLSRC_XOSC_gc | 0x03;	//SRC: XOSC, MUL: 3
	OSC.CTRL =  OSC_PLLEN_bm | OSC_XOSCEN_bm;	// Disable internal 2MHz, enable pll

	while (!(OSC.STATUS & OSC_PLLRDY_bm));

	//Deinit USB REG, which init by bootloader
	CLK.USBCTRL = 0x00;//Disable USB clock,

	PR.PRGEN &= ~0x40; //enable clock to usb, which disable by bootloader
	USB.CTRLA = 0x00;
	USB.CTRLB = 0x00;
	
	//buttons init
	ADCA.CTRLB        = 0x64;			// High current limit, signed mode, no free run, 8 bit
	ADCA.PRESCALER 	  = 0x07;		// Prescaler 512 (62.5kHZ ADC clock)
	ADCA.CTRLA		  = 0x01;	// Enable ADC

	ADCA.REFCTRL	  = 0x12;	// REF= VCC/1.6 (3.3V/1.6 = 2.0625V)
	ADCA.CH1.MUXCTRL  = 0x08;	// Channel 1 input: ADC1 pin
	ADCA.CH1.CTRL	  = 0x01;	// Single-ended positive input signal
}

const uint8_t key_value_map[] = {
	250, 231, 210, 186, 158, 126, 86, 0,
};

#define START_ADC()			(ADCA.CH1.CTRL |= 0x80)
#define WAIT_CONVERT()		do{ while(!(ADCA.CH1.INTFLAGS & 0x01)); ADCA.CH1.INTFLAGS = 1;}while(0)

uint8_t get_key_value(void)
{
	uint8_t  adc0, adc1, key;

	if(PORTA.IN & (1<<7)) {
		return KEY_MAIN;
	} else	{
		START_ADC();
		WAIT_CONVERT();
		adc0 = ADCA.CH1.RESL;
		if(adc0 <= 250) {
			_delay_ms(10);
			START_ADC();
			WAIT_CONVERT();
			adc1 = ADCA.CH1.RESL;
			if(adc0 - adc1 < 2) {
				for(key = 0; key < 8; key++) {
					if(adc0 >= key_value_map[key]) {
						return key;
					}
				}
			}
		}
	}

	return KEY_NONE;
}

void hell_watch_poll(void)
{
	if(PORTA.IN & (1<<7)) {//Main key at PA7
		hell_watch_print("Power OFF");
		USB_Disable();
		Delay_MS(900);
		OLED_ACTIVE();
		CMD_MODE();
		hell_watch_oled_cmd(0xAE);//DISP OFF
		OLED_DEACTIVE();
		Delay_MS(100);
		PORTA.OUTCLR = 1 << 6;//LDO off, Power lock at PA6
	}
}
#endif